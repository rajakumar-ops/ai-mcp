# Web Penetration Testing MCP Server - Helm Chart

This Helm chart deploys the Web Penetration Testing MCP Server to a Kubernetes cluster, providing a scalable and production-ready deployment option.

## Prerequisites

- Kubernetes 1.19+
- Helm 3.0+
- Docker image built and available in your registry
- Appropriate RBAC permissions for deployment

## Installation

### 1. Build and Push Docker Image

First, build and push the Docker image to your registry:

```bash
# Build the image
docker build -t your-registry/web-pentest-mcp-server:latest .

# Push to registry
docker push your-registry/web-pentest-mcp-server:latest
```

### 2. Install the Chart

```bash
# Add the chart repository (if using a chart repository)
helm repo add web-pentest-mcp https://your-chart-repo.com
helm repo update

# Install with default values
helm install web-pentest-mcp ./helm/web-pentest-mcp

# Or install with custom values
helm install web-pentest-mcp ./helm/web-pentest-mcp -f custom-values.yaml
```

### 3. Verify Installation

```bash
# Check pod status
kubectl get pods -l app.kubernetes.io/name=web-pentest-mcp

# Check service
kubectl get svc web-pentest-mcp

# View logs
kubectl logs -l app.kubernetes.io/name=web-pentest-mcp
```

## Configuration

### Values.yaml

The chart provides extensive configuration options through `values.yaml`:

#### Basic Configuration
```yaml
replicaCount: 1
image:
  repository: web-pentest-mcp-server
  tag: "latest"
  pullPolicy: IfNotPresent
```

#### Security Configuration
```yaml
security:
  networkPolicy:
    enabled: true
  podSecurityStandards:
    enabled: true
  scc:
    enabled: false
```

#### Monitoring Configuration
```yaml
monitoring:
  prometheus:
    enabled: true
    port: 9090
    path: /metrics
  healthCheck:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
```

#### Resource Configuration
```yaml
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi
```

### Custom Values File

Create a custom values file for your environment:

```yaml
# custom-values.yaml
image:
  repository: your-registry/web-pentest-mcp-server
  tag: "v1.0.0"

ingress:
  enabled: true
  className: "nginx"
  hosts:
    - host: web-pentest-mcp.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: web-pentest-mcp-tls
      hosts:
        - web-pentest-mcp.yourdomain.com

monitoring:
  prometheus:
    enabled: true
  serviceMonitor:
    enabled: true

security:
  networkPolicy:
    enabled: true
```

## Deployment Options

### 1. Development Deployment

```bash
helm install web-pentest-mcp ./helm/web-pentest-mcp \
  --set image.repository=your-registry/web-pentest-mcp-server \
  --set image.tag=dev \
  --set replicaCount=1 \
  --set resources.requests.cpu=100m \
  --set resources.requests.memory=256Mi
```

### 2. Production Deployment

```bash
helm install web-pentest-mcp ./helm/web-pentest-mcp \
  --set image.repository=your-registry/web-pentest-mcp-server \
  --set image.tag=v1.0.0 \
  --set replicaCount=3 \
  --set autoscaling.enabled=true \
  --set autoscaling.minReplicas=2 \
  --set autoscaling.maxReplicas=10 \
  --set ingress.enabled=true \
  --set monitoring.prometheus.enabled=true \
  --set security.networkPolicy.enabled=true
```

### 3. High Availability Deployment

```bash
helm install web-pentest-mcp ./helm/web-pentest-mcp \
  --set replicaCount=3 \
  --set podDisruptionBudget.enabled=true \
  --set podDisruptionBudget.minAvailable=2 \
  --set autoscaling.enabled=true \
  --set autoscaling.minReplicas=3 \
  --set autoscaling.maxReplicas=20 \
  --set affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions[0].key=app.kubernetes.io/name \
  --set affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions[0].operator=In \
  --set affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions[0].values[0]=web-pentest-mcp \
  --set affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].topologyKey=kubernetes.io/hostname
```

## Security Features

### 1. Pod Security Standards
- Non-root user execution
- Read-only root filesystem (configurable)
- Security context constraints
- Capability management

### 2. Network Policies
- Ingress and egress rules
- Namespace isolation
- Port restrictions
- Protocol filtering

### 3. RBAC
- Service account with minimal permissions
- Role-based access control
- Resource-specific permissions

### 4. Resource Limits
- CPU and memory limits
- Request specifications
- Quality of service classes

## Monitoring and Observability

### 1. Health Checks
- Liveness probes
- Readiness probes
- Startup probes (if supported)

### 2. Metrics
- Prometheus metrics endpoint
- ServiceMonitor for Prometheus Operator
- Custom metrics for security tools

### 3. Logging
- Structured logging
- Log aggregation support
- Debug mode configuration

## Scaling

### 1. Horizontal Pod Autoscaling
```yaml
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
```

### 2. Vertical Pod Autoscaling
```yaml
# Requires VPA operator
vpa:
  enabled: true
  updatePolicy: "Auto"
  resourcePolicy:
    cpu:
      min: "100m"
      max: "2000m"
    memory:
      min: "256Mi"
      max: "4Gi"
```

## Troubleshooting

### 1. Common Issues

#### Pod Not Starting
```bash
# Check pod status
kubectl describe pod <pod-name>

# Check logs
kubectl logs <pod-name>

# Check events
kubectl get events --sort-by=.metadata.creationTimestamp
```

#### Image Pull Errors
```bash
# Check image pull secrets
kubectl get secrets

# Verify image exists
docker pull your-registry/web-pentest-mcp-server:latest
```

#### Network Connectivity Issues
```bash
# Check network policies
kubectl get networkpolicies

# Test connectivity
kubectl exec -it <pod-name> -- ping <target>
```

### 2. Debug Mode

Enable debug logging:

```yaml
env:
  - name: DEBUG
    value: "1"
  - name: LOG_LEVEL
    value: "DEBUG"
```

### 3. Resource Issues

Check resource usage:

```bash
# Check resource usage
kubectl top pods -l app.kubernetes.io/name=web-pentest-mcp

# Check resource quotas
kubectl describe quota

# Check limit ranges
kubectl describe limitrange
```

## Upgrading

### 1. Upgrade Chart
```bash
# Upgrade to new version
helm upgrade web-pentest-mcp ./helm/web-pentest-mcp

# Upgrade with new values
helm upgrade web-pentest-mcp ./helm/web-pentest-mcp -f new-values.yaml
```

### 2. Rollback
```bash
# Check upgrade history
helm history web-pentest-mcp

# Rollback to previous version
helm rollback web-pentest-mcp 1
```

## Uninstalling

```bash
# Uninstall the chart
helm uninstall web-pentest-mcp

# Remove persistent volumes (if not needed)
kubectl delete pvc -l app.kubernetes.io/name=web-pentest-mcp
```

## Advanced Configuration

### 1. Custom ConfigMaps
```yaml
configMap:
  enabled: true
  data:
    custom.config: |
      # Custom configuration
      scan-timeout: 600
      max-retries: 5
```

### 2. Secrets Management
```yaml
secrets:
  enabled: true
  data:
    api-key: "base64-encoded-value"
    database-password: "base64-encoded-value"
```

### 3. Multi-Environment Deployment
```bash
# Development
helm install web-pentest-mcp-dev ./helm/web-pentest-mcp \
  --namespace development \
  --set image.tag=dev

# Staging
helm install web-pentest-mcp-staging ./helm/web-pentest-mcp \
  --namespace staging \
  --set image.tag=staging

# Production
helm install web-pentest-mcp-prod ./helm/web-pentest-mcp \
  --namespace production \
  --set image.tag=v1.0.0
```

## Best Practices

### 1. Security
- Use non-root containers
- Enable network policies
- Regular security updates
- Resource limits and requests

### 2. Monitoring
- Enable health checks
- Set up monitoring and alerting
- Log aggregation
- Performance metrics

### 3. Operations
- Use rolling updates
- Set up backup strategies
- Document configurations
- Regular testing

## Support

For issues and questions:
- Check the troubleshooting section
- Review Kubernetes documentation
- Check Helm chart documentation
- Contact your Kubernetes administrator

## License

This Helm chart is licensed under the MIT License.
